<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="stylesheet" href="./css/order.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Noto Sans:wght@400;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Noto Sans Tai Le:wght@400&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Noto Sans New Tai Lue:wght@500&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Kaushan Script:wght@400&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;700&display=swap"
    />
    <link rel="stylesheet" href="css/dropdown.css">
    <link rel="stylesheet" href="css/profilepic.css">
  </head>
  <style>
    .purchase{
      pointer-events: none;
    }
  </style>
  <body>
    <div class="payment-page-02">
      <main class="lead-developer-wrapper">
        <a class="lead-developer">Lead developer</a>
      </main>
      <header class="frame-parent">
        <div class="instance-wrapper">
          <div class="frame-group">
            <img class="instance-child" alt="" src="./images/group-136.svg" />

            <a class="search">Search</a>
          </div>
        </div>
        <div class="rectangle-parent">
          <div class="frame-child"></div>
          <img
            class="new-logo-1"
            loading="lazy"
            alt=""
            src="./images/new-logo-1@2x.png"
          />

          <img
            class="frame-item"
            loading="lazy"
            alt=""
            src="./images/group-134.svg"
            id="group"
          />
        </div>
        <nav class="frame-wrapper">
          <nav class="home-parent">
            <a class="home" id="homeText">Home</a>
            <a class="menu" id="menuText">Menu</a>
            <div class="about-us-wrapper">
              <a class="about-us" id="aboutUsText">About us</a>
            </div>
            <a class="feedback" id="feedbackText">Feedback</a>
          </nav>
        </nav>
        <img
          class="frame-inner"
          loading="lazy"
          alt=""
          id="profile-image"
          src="./images/images.png"
          
        />
        <div id="dropdown-menu" class="dropdown-menu">
          <a href="/profile">Profile</a>
          <a href="/payment">Payment History</a>
          <a href="/logout" id="logout">Logout</a>
      </div>
      </header>
      <div class="payment-page-02-inner">
        <div class="rectangle-group">
          <div class="rectangle-div"></div>
          <div class="frame-container">
            <div class="frame-div">
              <div class="order-summary-wrapper">
                <h1 class="order-summary">Order Summary</h1>
              </div>
              <div class="frame-parent1">
                <div class="rectangle-container">
                  <div class="frame-child1"></div>
                  <img
                    class="rectangle-icon"
                    alt=""
                    id="loadedImage"
                    src=""
                  />
                </div>
                <div class="frame-wrapper1">
                  <div class="nu-90-parent">
                    <b class="nu-90">NU. 90</b>
                    <b class="delivery">Delivery</b>
                    <div class="line-div"></div>
                    <b class="ema-datsi" id="loadedName"></b>
                    <div class="group-div">
                      <div class="frame-wrapper2">
                        <div class="location-icon-parent">
                            <img
                                class="location-icon"
                                id="add"
                                loading="lazy"
                                alt="Add"
                                src="./images/vector.svg"
                            />
                    
                            <div class="parent">
                                <b class="b" id="number">1</b>
                                <img
                                    id="sub"
                                    class="vector-icon"
                                    alt="Subtract"
                                    src="./images/vector-1.svg"
                                />
                            </div>
                        </div>
                    </div>
                      <!-- <div class="frame-parent2">
                        <div class="subtotal-parent">
                          <b class="subtotal">Subtotal</b>
                          <div class="nu-150-wrapper">
                            <b class="nu-150">NU. 150</b>
                          </div>
                        </div>
                        <div class="total-parent">
                          <b class="total">Total</b>
                          <b class="nu-240">Nu. 240</b>
                        </div>
                      </div> -->
                      <div class="frame-parent2">
                        <div class="subtotal-parent">
                            <b class="subtotal">Subtotal</b>
                            <div class="nu-150-wrapper">
                                <b class="nu-150" id="subtotal">NU. 150</b>
                            </div>
                        </div>
                        <div class="total-parent">
                            <b class="total">Total</b>
                            <b class="nu-240" id="total">NU. 240</b>
                        </div>
                    </div>
                    </div>
                    <div class="rectangle-parent1">
                      <div class="instance-item"></div>
                      <div class="gift-carddiscount-code">
                        Gift card/Discount code
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="vector-parent">
            <img class="frame-child2" alt="" src="./images/rectangle-85.svg" />

            <div class="frame-wrapper3">
              <div class="frame-parent3">
                <div class="payment-method-wrapper">
                  <h1 class="payment-method">Payment Method</h1>
                </div>
                <div class="frame-parent4">
                  <div class="frame-wrapper4">
                    <div class="credit-card-parent">
                      <b class="credit-card">Credit card</b>
                      <img
                        class="rupay-card-1-icon"
                        loading="lazy"
                        alt=""
                        src="./images/rupaycard-1@2x.png"
                      />
                    </div>
                  </div>
                  <div class="frame-wrapper5">
                    <div class="frame-parent5" id="groupContainer">
                      <div class="frame-wrapper6">
                        <div class="master-card-01-1024x654-3-parent">
                          <img
                            class="master-card-01-1024x654-3-icon"
                            loading="lazy"
                            alt=""
                            src="./images/mastercard011024x654-3@2x.png"
                          />

                          <img
                            class="master-card-01-1024x654-4-icon"
                            alt=""
                            src="./images/mastercard011024x654-4@2x.png"
                          />
                        </div>
                      </div>
                      <div class="atm-card-wrapper">
                        <div class="atm-card">Atm card</div>
                      </div>
                    </div>
                  </div>
                  <div
                    class="wrapper-ndi-app-removebg-previ-parent"
                    id="groupContainer"
                  >
                    <div class="wrapper-ndi-app-removebg-previ">
                      <img
                        class="ndi-app-removebg-preview-1-icon"
                        loading="lazy"
                        alt=""
                        src="./images/ndiappremovebgpreview-1@2x.png"
                      />
                    </div>
                    <div class="m-bob-wrapper">
                      <div class="m-bob">M BOB</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="instance-container">
              <div class="card-number-parent">
                <div class="card-number">Card Number</div>
                <div class="line-wrapper">
                  <div class="frame-child3"></div>
                </div>
              </div>
            </div>
            <div class="security-code-parent">
              <div class="security-code">Security code</div>
              <div class="line-container">
                <div class="frame-child4"></div>
              </div>
            </div>
            <div class="instance-frame">
              <div class="expdate-parent">
                <div class="expdate">Exp.Date</div>
                <div class="instance-inner"></div>
              </div>
            </div>
            <div class="group-68default-wrapper">
              <button class="group-68default" id="group68Default">
                <div class="group-68default-child" id="purchase"></div>
                <b class="purchase">Purchase</b>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="frameContainer" class="popup-overlay" style="display: none">
      <div class="rectangle-root">
        <div class="frame-child103"></div>
        <img class="frame-child104" alt="" src="./images/group-133600.svg" />

        <div class="personal-information" id="popuppersonalInformationText">
          Personal information
        </div>
        <div class="payment-details">Payment details</div>
        <div class="payment-history" id="popuppaymentHistoryText">
          Payment history
        </div>
        <div class="logout">Logout</div>
        <div class="frame-child105"></div>
        <div class="frame-child106"></div>
        <img class="frame-child107" alt="" src="./images/vector-30.svg" />
      </div>
    </div>

    <script>
      var popuppersonalInformationText = document.getElementById(
        "popuppersonalInformationText"
      );
      if (popuppersonalInformationText) {
        popuppersonalInformationText.addEventListener("click", function (e) {
          window.location.href = "./profile.html";
        });
      }
      
      var popuppaymentHistoryText = document.getElementById(
        "popuppaymentHistoryText"
      );
      if (popuppaymentHistoryText) {
        popuppaymentHistoryText.addEventListener("click", function (e) {
          // Please sync "payment history" to the project
        });
      }
      
      var group = document.getElementById("group");
      if (group) {
        group.addEventListener("click", function (e) {
          // Please sync "cart" to the project
        });
      }
      
      var homeText = document.getElementById("homeText");
      if (homeText) {
        homeText.addEventListener("click", function (e) {
          // Please sync "ZhayGo home page" to the project
        });
      }
      
      var menuText = document.getElementById("menuText");
      if (menuText) {
        menuText.addEventListener("click", function (e) {
          // Please sync "Our menu" to the project
        });
      }
      
      var aboutUsText = document.getElementById("aboutUsText");
      if (aboutUsText) {
        aboutUsText.addEventListener("click", function (e) {
          // Please sync "ZhayGo About us page" to the project
        });
      }
      
      var feedbackText = document.getElementById("feedbackText");
      if (feedbackText) {
        feedbackText.addEventListener("click", function (e) {
          window.location.href = "./feedback.html";
        });
      }
      
      var groupImage = document.getElementById("groupImage");
      if (groupImage) {
        groupImage.addEventListener("click", function () {
          var popup = document.getElementById("frameContainer");
          if (!popup) return;
          var popupStyle = popup.style;
          if (popupStyle) {
            popupStyle.display = "flex";
            popupStyle.zIndex = 100;
            popupStyle.backgroundColor = "rgba(113, 113, 113, 0.3)";
            popupStyle.alignItems = "center";
            popupStyle.justifyContent = "center";
          }
          popup.setAttribute("closable", "");
      
          var onClick =
            popup.onClick ||
            function (e) {
              if (e.target === popup && popup.hasAttribute("closable")) {
                popupStyle.display = "none";
              }
            };
          popup.addEventListener("click", onClick);
        });
      }
      
      var groupContainer = document.getElementById("groupContainer");
      if (groupContainer) {
        groupContainer.addEventListener("click", function (e) {
          // Please sync "Payment page 7" to the project
        });
      }
      
      var groupContainer = document.getElementById("groupContainer");
      if (groupContainer) {
        groupContainer.addEventListener("click", function (e) {
          // Please sync "Payment page 9" to the project
        });
      }
      
      var group68Default = document.getElementById("group68Default");
      if (group68Default) {
        group68Default.addEventListener("click", function (e) {
          // Please sync "Payment page 10" to the project
        });
      }
      </script>
      <script>
    document.addEventListener('DOMContentLoaded', function() {
    // Get references to the elements
    const addButton = document.getElementById('add');
    const subButton = document.getElementById('sub');
    const numberElement = document.getElementById('number');
    const subtotalElement = document.getElementById('subtotal');
    const totalElement = document.getElementById('total');

    // Constants
    const initialPrice = 150;
    const deliveryCharge = 90;

    // Function to update prices
    function updatePrices() {
        const quantity = parseInt(numberElement.textContent, 10);
        const subtotal = initialPrice * quantity;
        const total = subtotal + deliveryCharge;
        
        subtotalElement.textContent = `NU. ${subtotal}`;
        totalElement.textContent = `NU. ${total}`;
    }

    // Add event listeners to the buttons
    addButton.addEventListener('click', function() {
        let currentNumber = parseInt(numberElement.textContent, 10);
        numberElement.textContent = currentNumber + 1;
        updatePrices();
    });

    subButton.addEventListener('click', function() {
        let currentNumber = parseInt(numberElement.textContent, 10);
        if (currentNumber > 1) {
            numberElement.textContent = currentNumber - 1;
            updatePrices();
        }
    });

    // Initialize prices
    updatePrices();
});
 // Retrieve the image URL and dish name from localStorage
 const dishImage = localStorage.getItem('dishImage');
    const dishName = localStorage.getItem('dishName');

    // Set the image URL and dish name in the destination page
    document.getElementById('loadedImage').src = dishImage;
    document.getElementById('loadedName').textContent = dishName;
      </script>
      <script>
 const purchaseButton = document.getElementById("purchase");

purchaseButton.addEventListener("click", async function (event) {
    event.preventDefault();

    const curry = document.getElementById('loadedName').textContent;
    const quantity = document.getElementById('number').textContent;
    const price = document.getElementById('total').textContent;
    const imageurl = document.getElementById('loadedImage').src;
    const token = localStorage.getItem('token');

    console.log("asd");
    
    // Define token here

    try {
        const response = await fetch('http://localhost:3000/api/orders', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`,
            },
            body: JSON.stringify({ curry, quantity, price, imageurl }),
        });

        const data = await response.json();

        if (response.ok) {
            alert('Purchase Successful');
            console.log(data);
        } else {
            alert(`Error: ${data.message}`);
        }
    } catch (error) {
        console.error('Error making purchase:', error);
        alert('Internal server error');
    }
});
      </script>
      <script src="js/dropdown.js"></script>
      <script src="js/profile.js"></script>
  </body>
</html>
